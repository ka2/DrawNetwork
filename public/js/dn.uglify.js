function getURLParam(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}function insertURLParam(e,t){e=escape(e),t=escape(t);var n=document.location.search.substr(1).split("&");if(""==n)document.location.search="?"+e+"="+t;else{for(var o,r=n.length;r--;)if(o=n[r].split("="),o[0]==e){o[1]=t,n[r]=o.join("=");break}0>r&&(n[n.length]=[e,t].join("="))}}function checkHomeState(){if(null!=getURLParam("room")){var e=document.getElementById("home-content");e.className="invisible",document.getElementById("save-room").className="nav-opt save"}}function checkPageState(){if(null!=getURLParam("room")){var e=document.getElementById("home-content");e.className="invisible";var t=document.getElementById("draw-content");return t.className="",!0}var t=document.getElementById("draw-content");return t.className="invisible",!1}function convertTime(e){var t="",n="now";return 1===e?n="second":e>1&&60>e?n="seconds":e>=60&&120>e?(e/=60,n="minute"):e>=120&&3600>e?(e/=60,n="minutes"):e>=3600&&7200>e?(e=e/60/60,n="hour"):e>=7200&&86400>e?(e=e/60/60,n="hours"):e>=86400&&172800>e?(e=e/60/60/24,n="day"):e>=172800&&(e=e/60/60/24,n="days"),e=Math.floor(e),t="now"===n?n:e+" "+n}function isOverflowed(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}function createRadioElement(e,t,n){var o='<input id="'+t+'-radio" type="radio" name="'+e+'" value="'+t+'"';n&&(o+=' checked="checked"'),o+="/>";var r=document.getElementById("room-container");r.innerHTML+=o}function sendChatMessage(){var e={name:name,message:document.getElementById("chat-message").value};e.message.length>0&&(document.getElementById("chat-message").value="",addChatMessage(e),socket.emit("chat message",e))}function pickRandomName(){var e=Math.floor(Math.random()*randomNames.length);return randomNames[e]}function setNameTextBox(){var e=pickRandomName();document.getElementById("name").value=e,name=e}function init(){context.fillStyle="white",context.fillRect(0,0,canvas.width,canvas.height),webGLStart(),getNameList()}function getNameList(){var e=new XMLHttpRequest;e.open("GET","/files/names.txt",!0),e.onreadystatechange=function(){4===e.readyState&&200===e.status&&(allText=e.responseText,lines=e.responseText.split("\n"),randomNames=lines,setNameTextBox())},e.send(null)}function createRoom(){var e=document.getElementById("myonoffswitch").checked;socket.emit("create room",e)}function joinRoom(){insertURLParam("room",selectedRoom)}function sync(){if(hasSynced===!1){name=document.getElementById("name").value;var e={id:getURLParam("room"),name:name,colour:tool.brush.colour};socket.emit("join room",getURLParam("room")),socket.emit("im online",e)}}function clearChatNotifs(){messageCounter=0,document.getElementById("users-chat-tab").innerHTML="<a>Chat</a>"}function clearUserCounter(){userJoinCounter=0,document.getElementById("users-online-tab").innerHTML="<a>Users Online</a>"}function addChatMessage(e){var t=document.getElementById("chat-box"),n=e.name;e.name===name&&(n="You");var o='<div class="chat-row"><div class="name" style="font-weight: bold;">'+n+': </div><div class="message"><p>'+e.message+"</p></div></div>";t.innerHTML+=o,t.scrollTop=t.scrollHeight}function clearVote(e){socket.emit("recieve clear vote",e),document.getElementById("voteButtons").className="invisible"}function clearCanvas(){socket.emit("vote clear"),document.getElementById("voteButtons").className="invisible"}function distanceBetween(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function angleBetween(e,t){return Math.atan2(t.x-e.x,t.y-e.y)}function saveRoom(){if(hasSynced===!0){currentlySaving=!0,document.getElementById("save-wrap").className="table-visible",document.getElementById("save-progress").className="";var e={canvas:canvas.toDataURL()};socket.emit("store canvas",e)}}function clearUsers(){var e=document.getElementById("users");e.innerHTML=""}function addUser(e,t){var n=document.getElementById("users"),o='<div id="'+e+'"class="row"><div class="user-colour" style="background-color: '+t+'"></div><div class="user-name">'+e+"</div></div>";n.innerHTML+=o}function getRandomColor(){for(var e="0123456789ABCDEF".split(""),t="#",n=0;6>n;n++)t+=e[Math.floor(16*Math.random())];return t}function getMousePos(e){return{x:e.clientX,y:e.clientY}}function changeLineTip(){var e=document.getElementById("lineTip");tool.brush.lineTip=e.options[e.selectedIndex].value}function inputColourChange(){var e={r:0|document.getElementById("rValue").value,g:0|document.getElementById("gValue").value,b:0|document.getElementById("bValue").value};onColourChange(e)}function onHexChange(){if(7==document.getElementById("hexValue").value.length){var e=convertHexToRGB(document.getElementById("hexValue").value);onColourChange(e)}}function onColourChange(e){var t=convertRGBToHex(e.r,e.g,e.b),n=convertRGBToHSV(e.r,e.g,e.b);tintPointer={x:Math.ceil(2.55*(100-n.s)),y:Math.ceil(2.55*(100-n.v))},huePointer={y:Math.ceil((360-n.h)/360*255)},updateColour(),tool.brush.setColour(t)}function applyText(){if(1==readyForText){var e=canvas.getBoundingClientRect(),t={x:textPos.x-e.left,y:textPos.y-e.top,font:tool.textTool.textFont,colour:tool.brush.colour,text:tool.textTool.textToRender};socket.emit("draw text",t),tool.textTool.drawText(t.x,t.y,tool.textTool.textFont,t.colour,tool.textTool.textToRender),tool.textTool.textToRender="",document.getElementById("text-tool-text").value="",tool.textTool.drawTempText(textPos.x,textPos.y,tool.textTool.textFont,t.colour,tool.textTool.textToRender),readyForText=!1,document.getElementById("text-tool-text").blur()}}function resetCategoryFlags(){tool.textTool.textToRender="",readyForText=!1,document.getElementById("brushes").className="button tool",document.getElementById("colourDrop").className="button tool",document.getElementById("text-tool").className="button tool",document.getElementById("shape-tool").className="button tool"}function resetSubCategoryFlags(){document.getElementById("brush").className="button tool",document.getElementById("square-brush").className="button tool",document.getElementById("gradient-brush").className="button tool",document.getElementById("rainbow-brush").className="button tool",document.getElementById("line-tool").className="button tool",document.getElementById("eraser").className="button tool",document.getElementById("shapeRect").className="button tool",document.getElementById("shapeCircle").className="button tool",document.getElementById("brush-settings").className="invisible",document.getElementById("rainbow-settings").className="invisible",document.getElementById("dropper-settings").className="invisible",document.getElementById("text-settings").className="invisible",document.getElementById("shape-settings").className="invisible",document.getElementById("line-settings").className="invisible"}function fillBucket(e,t){for(var n=hexToRgb(t),o=getColourOnCanvas(canvas,context),r=e.getImageData(0,0,canvas.width,canvas.height),a=0;a<r.data.length-4;a+=4)r.data[a]==o.r&&r.data[a+1]==o.g&&r.data[a+2]==o.b&&r.data[a+3]==o.a&&(r.data[a]=n.r,r.data[a+1]=n.g,r.data[a+2]=n.b,r.data[a+3]=255);context.putImageData(r,0,0),socket.emit("canvas update",canvas.toDataURL())}function hexToRgb(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function webGLStart(){webglCanvas=document.getElementById("webgl-temp"),tintCanvas=document.getElementById("tint"),tintCtx=tintCanvas.getContext("2d"),tintPointerCanvas=document.getElementById("tint-pointer"),tintPointerCtx=tintPointerCanvas.getContext("2d"),hueCanvas=document.getElementById("hue"),hueCtx=hueCanvas.getContext("2d"),image=new Image,image.onload=function(){hueCtx.drawImage(image,0,0)},image.src="img/colour-range.png",initGL(webglCanvas),initShaders(),initBuffers(),gl.clearColor(0,0,0,1),gl.disable(gl.DEPTH_TEST),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),drawColourSquare(),drawTintPointer()}function initGL(e){try{gl=e.getContext("webgl",{alpha:!1})||e.getContext("experimental-webgl",{alpha:!1}),gl.viewportWidth=e.width,gl.viewportHeight=e.height}catch(t){}gl||alert("Could not initialise WebGL, sorry :-( ")}function initShaders(){var e=getShaderFromVar(basicFragShader,"Frag"),t=getShaderFromVar(basicVertShader,"Vert");shaderProgram=gl.createProgram(),gl.attachShader(shaderProgram,t),gl.attachShader(shaderProgram,e),gl.linkProgram(shaderProgram),gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)||alert("Could not initialise shaders"),gl.useProgram(shaderProgram),shaderProgram.vertexPositionAttribute=gl.getAttribLocation(shaderProgram,"aVertexPosition"),gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute),shaderProgram.vertexColorAttribute=gl.getAttribLocation(shaderProgram,"aVertexColor"),gl.enableVertexAttribArray(shaderProgram.vertexColorAttribute),shaderProgram.pMatrixUniform=gl.getUniformLocation(shaderProgram,"uPMatrix"),shaderProgram.mvMatrixUniform=gl.getUniformLocation(shaderProgram,"uMVMatrix")}function getShaderFromVar(e,t){var n;if("Vert"==t||"Vertex"==t||"VertexShader"==t)n=gl.createShader(gl.VERTEX_SHADER);else{if("Frag"!=t&&"Fragment"!=t&&"FragmentShader"!=t)return void console.log("Error: Cannot get shader. Invalid type provided.");n=gl.createShader(gl.FRAGMENT_SHADER)}return gl.shaderSource(n,e),gl.compileShader(n),gl.getShaderParameter(n,gl.COMPILE_STATUS)?n:(alert(gl.getShaderInfoLog(n)),null)}function initBuffers(){squareVertexPositionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,squareVertexPositionBuffer),vertices=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW),squareVertexPositionBuffer.itemSize=3,squareVertexPositionBuffer.numItems=4,blackVertexColorBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,blackVertexColorBuffer);var e=[0,0,0,0,0,0,0,0,0,0,0,1.003,0,0,0,1.003];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e),gl.DYNAMIC_DRAW),blackVertexColorBuffer.itemSize=4,blackVertexColorBuffer.numItems=4,squareVertexColorBuffer=gl.createBuffer();var t=checkPrimaryColour(pickedColour.r,pickedColour.g,pickedColour.b);gl.bindBuffer(gl.ARRAY_BUFFER,squareVertexColorBuffer);var e=[1.0015,1.0015,1.0015,1,pickedColour.r/255+t.r,pickedColour.g/255+t.g,pickedColour.b/255+t.b,1,1.0015,1.0015,1.0015,1,pickedColour.r/255+t.r,pickedColour.g/255+t.g,pickedColour.b/255+t.b,1];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e),gl.DYNAMIC_DRAW),squareVertexColorBuffer.itemSize=4,squareVertexColorBuffer.numItems=4}function updateColourBuffer(){gl.bindBuffer(gl.ARRAY_BUFFER,blackVertexColorBuffer);var e=[0,0,0,0,0,0,0,0,0,0,0,1.003,0,0,0,1.003];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e),gl.DYNAMIC_DRAW),blackVertexColorBuffer.itemSize=4,blackVertexColorBuffer.numItems=4;var t=checkPrimaryColour(pickedColour.r,pickedColour.g,pickedColour.b);gl.bindBuffer(gl.ARRAY_BUFFER,squareVertexColorBuffer);var e=[1.0015,1.0015,1.0015,1,pickedColour.r/255+t.r,pickedColour.g/255+t.g,pickedColour.b/255+t.b,1,1.0015,1.0015,1.0015,1,pickedColour.r/255+t.r,pickedColour.g/255+t.g,pickedColour.b/255+t.b,1];gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e),gl.DYNAMIC_DRAW),squareVertexColorBuffer.itemSize=4,squareVertexColorBuffer.numItems=4,drawColourSquare()}function checkPrimaryColour(e,t,n){var o={r:0,g:0,b:0};return 255==e&&(o.r=.003),255==t&&(o.g=.003),255==n&&(o.b=.003),o}function setMatrixUniforms(){gl.uniformMatrix4fv(shaderProgram.pMatrixUniform,!1,pMatrix),gl.uniformMatrix4fv(shaderProgram.mvMatrixUniform,!1,mvMatrix)}function drawColourSquare(){gl.viewport(0,0,gl.viewportWidth,gl.viewportHeight),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),mat4.ortho(this.pMatrix,-1,1,-1,1,.1,100),mat4.identity(mvMatrix),mat4.translate(mvMatrix,mvMatrix,[0,0,-1]),setMatrixUniforms(),gl.bindBuffer(gl.ARRAY_BUFFER,squareVertexPositionBuffer),gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,squareVertexPositionBuffer.itemSize,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,squareVertexColorBuffer),gl.vertexAttribPointer(shaderProgram.vertexColorAttribute,squareVertexColorBuffer.itemSize,gl.FLOAT,!1,0,0),gl.drawArrays(gl.TRIANGLE_STRIP,0,squareVertexPositionBuffer.numItems),gl.bindBuffer(gl.ARRAY_BUFFER,squareVertexPositionBuffer),gl.vertexAttribPointer(shaderProgram.vertexPositionAttribute,squareVertexPositionBuffer.itemSize,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,blackVertexColorBuffer),gl.vertexAttribPointer(shaderProgram.vertexColorAttribute,blackVertexColorBuffer.itemSize,gl.FLOAT,!1,0,0),gl.drawArrays(gl.TRIANGLE_STRIP,0,squareVertexPositionBuffer.numItems),tintCtx.drawImage(webglCanvas,0,0)}function drawTintPointer(){tintPointerCtx.clearRect(0,0,tintPointerCanvas.width,tintPointerCanvas.height),tintPointerCtx.beginPath(),tintPointerCtx.strokeStyle="white",tintPointerCtx.arc(tintPointer.x,tintPointer.y,5,0,2*Math.PI),tintPointerCtx.stroke(),tintPointerCtx.beginPath(),tintPointerCtx.strokeStyle="black",tintPointerCtx.arc(tintPointer.x,tintPointer.y,6,0,2*Math.PI),tintPointerCtx.stroke(),tintPointerCtx.beginPath(),tintPointerCtx.strokeStyle="white",tintPointerCtx.arc(tintPointer.x,tintPointer.y,7,0,2*Math.PI),tintPointerCtx.stroke()}function changeColour(){var e={r:0,g:0,b:0};if(canMoveTintPointer===!0){var t=tintCanvas.getBoundingClientRect();if(mouseIsHoveringCanvas(tintCanvas))tintPointer=mousePos,tintPointer.x-=t.left,tintPointer.y-=t.top;else{var n=mousePos;n.x<t.left&&n.y<t.top?(tintPointer.x=0,tintPointer.y=0):n.x>=t.right&&n.y<t.top?(tintPointer.x=255,tintPointer.y=0):n.x>=t.right&&n.y>=t.bottom?(tintPointer.x=255,tintPointer.y=255):n.x<t.left&&n.y>=t.bottom?(tintPointer.x=0,tintPointer.y=255):n.x<t.left?(tintPointer.x=0,tintPointer.y=n.y-t.top):n.x>=t.right?(tintPointer.x=255,tintPointer.y=n.y-t.top):n.y<t.top?(tintPointer.x=n.x-t.left,tintPointer.y=0):n.y>=t.bottom&&(tintPointer.x=n.x-t.left,tintPointer.y=255)}e=getColourOnTintCanvas(),pickedColour.r=e.r,pickedColour.g=e.g,pickedColour.b=e.b,tool.brush.setColour(convertRGBToHex(e.r,e.g,e.b));var o=document.getElementById("currentColour");o.style.backgroundColor=convertRGBToHex(pickedColour.r,pickedColour.g,pickedColour.b),assignHTMLValues(),drawTintPointer()}else if(canMoveHuePointer===!0){var r=hueCanvas.getBoundingClientRect();if(mouseIsHoveringCanvas(hueCanvas))huePointer.y=mousePos.y-r.top;else{var n=mousePos;n.x<r.left&&n.y<r.top?(huePointer.x=0,huePointer.y=0):n.x>=r.right&&n.y<r.top?(huePointer.x=0,huePointer.y=0):n.x>=r.right&&n.y>=r.bottom?(huePointer.x=0,huePointer.y=255):n.x<r.left&&n.y>=r.bottom?(huePointer.x=0,huePointer.y=255):n.x<r.left?(huePointer.x=0,huePointer.y=n.y-r.top):n.x>=r.right?(huePointer.x=0,huePointer.y=n.y-r.top):n.y<r.top?(huePointer.x=n.x-r.left,huePointer.y=0):n.y>=r.bottom&&(huePointer.x=n.x-r.left,huePointer.y=255)}e=getColourOnHueCanvas(),pickedColour.r=e.r,pickedColour.g=e.g,pickedColour.b=e.b,tool.brush.setColour(convertRGBToHex(e.r,e.g,e.b));var o=document.getElementById("currentColour");o.style.backgroundColor=convertRGBToHex(pickedColour.r,pickedColour.g,pickedColour.b);var a=document.getElementById("palette-arrow");a.style.top=huePointer.y-10+"px",assignHTMLValues(),updateColourBuffer(),e=getColourOnTintCanvas(),pickedColour.r=e.r,pickedColour.g=e.g,pickedColour.b=e.b,tool.brush.setColour(convertRGBToHex(e.r,e.g,e.b));var o=document.getElementById("currentColour");o.style.backgroundColor=convertRGBToHex(pickedColour.r,pickedColour.g,pickedColour.b),assignHTMLValues()}(new Date).getTime()>colourTimer+200&&(colourTimer=(new Date).getTime(),socket.emit("update colour",tool.brush.colour))}function updateColour(){rgb=getColourOnHueCanvas(),pickedColour.r=rgb.r,pickedColour.g=rgb.g,pickedColour.b=rgb.b,tool.brush.setColour(convertRGBToHex(rgb.r,rgb.g,rgb.b));var e=document.getElementById("currentColour");e.style.backgroundColor=convertRGBToHex(pickedColour.r,pickedColour.g,pickedColour.b);var t=document.getElementById("palette-arrow");t.style.top=huePointer.y-10+"px",assignHTMLValues(),updateColourBuffer(),rgb=getColourOnTintCanvas(),pickedColour.r=rgb.r,pickedColour.g=rgb.g,pickedColour.b=rgb.b,tool.brush.setColour(convertRGBToHex(rgb.r,rgb.g,rgb.b));var e=document.getElementById("currentColour");e.style.backgroundColor=convertRGBToHex(pickedColour.r,pickedColour.g,pickedColour.b),assignHTMLValues(),drawTintPointer()}function getScrollAmount(){var e=document.documentElement,t=(window.pageXOffset||e.scrollLeft)-(e.clientLeft||0),n=(window.pageYOffset||e.scrollTop)-(e.clientTop||0);return{x:t,y:n}}function mouseIsHoveringCanvas(e){var t=mousePos;return canvasRect=e.getBoundingClientRect(),t.x>=canvasRect.left&&t.x<=canvasRect.right&&t.y>=canvasRect.top&&t.y<=canvasRect.bottom?!0:!1}function assignHTMLValues(){var e=document.getElementById("rValue");e.value=pickedColour.r;var t=document.getElementById("gValue");t.value=pickedColour.g;var n=document.getElementById("bValue");n.value=pickedColour.b;var o=document.getElementById("hexValue");o.value=convertRGBToHex(pickedColour.r,pickedColour.g,pickedColour.b)}function getColourOnTintCanvas(){var e=tintPointer.x,t=tintPointer.y;e>=254&&(e=254),t>=254&&(t=254);var n=tintCtx.getImageData(e,t,1,1),o=n.data,r={r:o[0],g:o[1],b:o[2],a:o[3]};return r}function getColourOnHueCanvas(){var e=huePointer.y;e>=254&&(e=254);var t=hueCtx.getImageData(0,e,1,e+1),n=t.data,o={r:n[0],g:n[1],b:n[2],a:n[3]};return o}function getColourOnCanvas(e,t){var n=e.getBoundingClientRect(),o=document.documentElement,r=((window.pageXOffset||o.scrollLeft)-(o.clientLeft||0),(window.pageYOffset||o.scrollTop)-(o.clientTop||0),mousePos.x-n.left),a=mousePos.y-n.top,s=t.getImageData(r,a,1,1),i=s.data,l={r:i[0],g:i[1],b:i[2],a:i[3]};return l}function convertRGBToHex(e,t,n){var o=e.toString(16),r=t.toString(16),a=n.toString(16);return"#"+binaryResult(o)+binaryResult(r)+binaryResult(a)}function convertHexToRGB(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function binaryResult(e){return 1===e.length?"0"+e:e}function assignRGBToDom(e,t,n,o){rgbInputs.r.value=e,rgbInputs.g.value=t,rgbInputs.b.value=n,rgbInputs.hex.value=o}function convertRGBToHSV(){var e,t,n,o,r,a=arguments[0]/255,s=arguments[1]/255,i=arguments[2]/255,l=Math.max(a,s,i),u=l-Math.min(a,s,i),c=function(e){return(l-e)/6/u+.5};return 0==u?o=r=0:(r=u/l,e=c(a),t=c(s),n=c(i),a===l?o=n-t:s===l?o=1/3+e-n:i===l&&(o=2/3+t-e),0>o?o+=1:o>1&&(o-=1)),{h:Math.round(360*o),s:Math.round(100*r),v:Math.round(100*l)}}!function(e){"use strict";var t={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports="undefined"!=typeof window?window:e:t.exports=exports,function(e){if(!t)var t=1e-6;if(!n)var n="undefined"!=typeof Float32Array?Float32Array:Array;if(!o)var o=Math.random;var r={};r.setMatrixArrayType=function(e){n=e},"undefined"!=typeof e&&(e.glMatrix=r);var a=Math.PI/180;r.toRadian=function(e){return e*a};var s={};s.create=function(){var e=new n(2);return e[0]=0,e[1]=0,e},s.clone=function(e){var t=new n(2);return t[0]=e[0],t[1]=e[1],t},s.fromValues=function(e,t){var o=new n(2);return o[0]=e,o[1]=t,o},s.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},s.set=function(e,t,n){return e[0]=t,e[1]=n,e},s.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},s.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},s.sub=s.subtract,s.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},s.mul=s.multiply,s.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},s.div=s.divide,s.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},s.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},s.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},s.scaleAndAdd=function(e,t,n,o){return e[0]=t[0]+n[0]*o,e[1]=t[1]+n[1]*o,e},s.distance=function(e,t){var n=t[0]-e[0],o=t[1]-e[1];return Math.sqrt(n*n+o*o)},s.dist=s.distance,s.squaredDistance=function(e,t){var n=t[0]-e[0],o=t[1]-e[1];return n*n+o*o},s.sqrDist=s.squaredDistance,s.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},s.len=s.length,s.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},s.sqrLen=s.squaredLength,s.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},s.normalize=function(e,t){var n=t[0],o=t[1],r=n*n+o*o;return r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r),e},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},s.cross=function(e,t,n){var o=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=o,e},s.lerp=function(e,t,n,o){var r=t[0],a=t[1];return e[0]=r+o*(n[0]-r),e[1]=a+o*(n[1]-a),e},s.random=function(e,t){t=t||1;var n=2*o()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},s.transformMat2=function(e,t,n){var o=t[0],r=t[1];return e[0]=n[0]*o+n[2]*r,e[1]=n[1]*o+n[3]*r,e},s.transformMat2d=function(e,t,n){var o=t[0],r=t[1];return e[0]=n[0]*o+n[2]*r+n[4],e[1]=n[1]*o+n[3]*r+n[5],e},s.transformMat3=function(e,t,n){var o=t[0],r=t[1];return e[0]=n[0]*o+n[3]*r+n[6],e[1]=n[1]*o+n[4]*r+n[7],e},s.transformMat4=function(e,t,n){var o=t[0],r=t[1];return e[0]=n[0]*o+n[4]*r+n[12],e[1]=n[1]*o+n[5]*r+n[13],e},s.forEach=function(){var e=s.create();return function(t,n,o,r,a,s){var i,l;for(n||(n=2),o||(o=0),l=r?Math.min(r*n+o,t.length):t.length,i=o;l>i;i+=n)e[0]=t[i],e[1]=t[i+1],a(e,e,s),t[i]=e[0],t[i+1]=e[1];return t}}(),s.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},"undefined"!=typeof e&&(e.vec2=s);var i={};i.create=function(){var e=new n(3);return e[0]=0,e[1]=0,e[2]=0,e},i.clone=function(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},i.fromValues=function(e,t,o){var r=new n(3);return r[0]=e,r[1]=t,r[2]=o,r},i.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},i.set=function(e,t,n,o){return e[0]=t,e[1]=n,e[2]=o,e},i.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},i.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},i.sub=i.subtract,i.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},i.mul=i.multiply,i.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},i.div=i.divide,i.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},i.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},i.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},i.scaleAndAdd=function(e,t,n,o){return e[0]=t[0]+n[0]*o,e[1]=t[1]+n[1]*o,e[2]=t[2]+n[2]*o,e},i.distance=function(e,t){var n=t[0]-e[0],o=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+o*o+r*r)},i.dist=i.distance,i.squaredDistance=function(e,t){var n=t[0]-e[0],o=t[1]-e[1],r=t[2]-e[2];return n*n+o*o+r*r},i.sqrDist=i.squaredDistance,i.length=function(e){var t=e[0],n=e[1],o=e[2];return Math.sqrt(t*t+n*n+o*o)},i.len=i.length,i.squaredLength=function(e){var t=e[0],n=e[1],o=e[2];return t*t+n*n+o*o},i.sqrLen=i.squaredLength,i.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},i.normalize=function(e,t){var n=t[0],o=t[1],r=t[2],a=n*n+o*o+r*r;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e},i.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},i.cross=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=n[0],i=n[1],l=n[2];return e[0]=r*l-a*i,e[1]=a*s-o*l,e[2]=o*i-r*s,e},i.lerp=function(e,t,n,o){var r=t[0],a=t[1],s=t[2];return e[0]=r+o*(n[0]-r),e[1]=a+o*(n[1]-a),e[2]=s+o*(n[2]-s),e},i.random=function(e,t){t=t||1;var n=2*o()*Math.PI,r=2*o()-1,a=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=r*t,e},i.transformMat4=function(e,t,n){var o=t[0],r=t[1],a=t[2];return e[0]=n[0]*o+n[4]*r+n[8]*a+n[12],e[1]=n[1]*o+n[5]*r+n[9]*a+n[13],e[2]=n[2]*o+n[6]*r+n[10]*a+n[14],e},i.transformMat3=function(e,t,n){var o=t[0],r=t[1],a=t[2];return e[0]=o*n[0]+r*n[3]+a*n[6],e[1]=o*n[1]+r*n[4]+a*n[7],e[2]=o*n[2]+r*n[5]+a*n[8],e},i.transformQuat=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=n[0],i=n[1],l=n[2],u=n[3],c=u*o+i*a-l*r,d=u*r+l*o-s*a,m=u*a+s*r-i*o,g=-s*o-i*r-l*a;return e[0]=c*u+g*-s+d*-l-m*-i,e[1]=d*u+g*-i+m*-s-c*-l,e[2]=m*u+g*-l+c*-i-d*-s,e},i.rotateX=function(e,t,n,o){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(o)-r[2]*Math.sin(o),a[2]=r[1]*Math.sin(o)+r[2]*Math.cos(o),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},i.rotateY=function(e,t,n,o){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[2]*Math.sin(o)+r[0]*Math.cos(o),a[1]=r[1],a[2]=r[2]*Math.cos(o)-r[0]*Math.sin(o),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},i.rotateZ=function(e,t,n,o){var r=[],a=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],a[0]=r[0]*Math.cos(o)-r[1]*Math.sin(o),a[1]=r[0]*Math.sin(o)+r[1]*Math.cos(o),a[2]=r[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},i.forEach=function(){var e=i.create();return function(t,n,o,r,a,s){var i,l;for(n||(n=3),o||(o=0),l=r?Math.min(r*n+o,t.length):t.length,i=o;l>i;i+=n)e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],a(e,e,s),t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2];return t}}(),i.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},"undefined"!=typeof e&&(e.vec3=i);var l={};l.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},l.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},l.fromValues=function(e,t,o,r){var a=new n(4);return a[0]=e,a[1]=t,a[2]=o,a[3]=r,a},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},l.set=function(e,t,n,o,r){return e[0]=t,e[1]=n,e[2]=o,e[3]=r,e},l.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},l.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},l.sub=l.subtract,l.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},l.mul=l.multiply,l.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},l.div=l.divide,l.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},l.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},l.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},l.scaleAndAdd=function(e,t,n,o){return e[0]=t[0]+n[0]*o,e[1]=t[1]+n[1]*o,e[2]=t[2]+n[2]*o,e[3]=t[3]+n[3]*o,e},l.distance=function(e,t){var n=t[0]-e[0],o=t[1]-e[1],r=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+o*o+r*r+a*a)},l.dist=l.distance,l.squaredDistance=function(e,t){var n=t[0]-e[0],o=t[1]-e[1],r=t[2]-e[2],a=t[3]-e[3];return n*n+o*o+r*r+a*a},l.sqrDist=l.squaredDistance,l.length=function(e){var t=e[0],n=e[1],o=e[2],r=e[3];return Math.sqrt(t*t+n*n+o*o+r*r)},l.len=l.length,l.squaredLength=function(e){var t=e[0],n=e[1],o=e[2],r=e[3];return t*t+n*n+o*o+r*r},l.sqrLen=l.squaredLength,l.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},l.normalize=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=n*n+o*o+r*r+a*a;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s),e},l.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},l.lerp=function(e,t,n,o){var r=t[0],a=t[1],s=t[2],i=t[3];return e[0]=r+o*(n[0]-r),e[1]=a+o*(n[1]-a),e[2]=s+o*(n[2]-s),e[3]=i+o*(n[3]-i),e},l.random=function(e,t){return t=t||1,e[0]=o(),e[1]=o(),e[2]=o(),e[3]=o(),l.normalize(e,e),l.scale(e,e,t),e},l.transformMat4=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3];return e[0]=n[0]*o+n[4]*r+n[8]*a+n[12]*s,e[1]=n[1]*o+n[5]*r+n[9]*a+n[13]*s,e[2]=n[2]*o+n[6]*r+n[10]*a+n[14]*s,e[3]=n[3]*o+n[7]*r+n[11]*a+n[15]*s,e},l.transformQuat=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=n[0],i=n[1],l=n[2],u=n[3],c=u*o+i*a-l*r,d=u*r+l*o-s*a,m=u*a+s*r-i*o,g=-s*o-i*r-l*a;return e[0]=c*u+g*-s+d*-l-m*-i,e[1]=d*u+g*-i+m*-s-c*-l,e[2]=m*u+g*-l+c*-i-d*-s,e},l.forEach=function(){var e=l.create();return function(t,n,o,r,a,s){var i,l;for(n||(n=4),o||(o=0),l=r?Math.min(r*n+o,t.length):t.length,i=o;l>i;i+=n)e[0]=t[i],e[1]=t[i+1],e[2]=t[i+2],e[3]=t[i+3],a(e,e,s),t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2],t[i+3]=e[3];return t}}(),l.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!=typeof e&&(e.vec4=l);var u={};u.create=function(){var e=new n(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},u.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},u.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},u.invert=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=n*a-r*o;return s?(s=1/s,e[0]=a*s,e[1]=-o*s,e[2]=-r*s,e[3]=n*s,e):null},u.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},u.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},u.multiply=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=n[0],l=n[1],u=n[2],c=n[3];return e[0]=o*i+a*l,e[1]=r*i+s*l,e[2]=o*u+a*c,e[3]=r*u+s*c,e},u.mul=u.multiply,u.rotate=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=Math.sin(n),l=Math.cos(n);return e[0]=o*l+a*i,e[1]=r*l+s*i,e[2]=o*-i+a*l,e[3]=r*-i+s*l,e},u.scale=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=n[0],l=n[1];return e[0]=o*i,e[1]=r*i,e[2]=a*l,e[3]=s*l,e},u.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},u.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},u.LDU=function(e,t,n,o){return e[2]=o[2]/o[0],n[0]=o[0],n[1]=o[1],n[3]=o[3]-e[2]*n[1],[e,t,n]},"undefined"!=typeof e&&(e.mat2=u);var c={};c.create=function(){var e=new n(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},c.clone=function(e){var t=new n(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},c.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},c.invert=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=t[4],i=t[5],l=n*a-o*r;return l?(l=1/l,e[0]=a*l,e[1]=-o*l,e[2]=-r*l,e[3]=n*l,e[4]=(r*i-a*s)*l,e[5]=(o*s-n*i)*l,e):null},c.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},c.multiply=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=t[4],l=t[5],u=n[0],c=n[1],d=n[2],m=n[3],g=n[4],h=n[5];return e[0]=o*u+a*c,e[1]=r*u+s*c,e[2]=o*d+a*m,e[3]=r*d+s*m,e[4]=o*g+a*h+i,e[5]=r*g+s*h+l,e},c.mul=c.multiply,c.rotate=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=t[4],l=t[5],u=Math.sin(n),c=Math.cos(n);return e[0]=o*c+a*u,e[1]=r*c+s*u,e[2]=o*-u+a*c,e[3]=r*-u+s*c,e[4]=i,e[5]=l,e},c.scale=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=t[4],l=t[5],u=n[0],c=n[1];return e[0]=o*u,e[1]=r*u,e[2]=a*c,e[3]=s*c,e[4]=i,e[5]=l,e},c.translate=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=t[4],l=t[5],u=n[0],c=n[1];return e[0]=o,e[1]=r,e[2]=a,e[3]=s,e[4]=o*u+a*c+i,e[5]=r*u+s*c+l,e},c.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},c.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},"undefined"!=typeof e&&(e.mat2d=c);var d={};d.create=function(){var e=new n(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},d.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},d.clone=function(e){var t=new n(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},d.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},d.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},d.transpose=function(e,t){if(e===t){var n=t[1],o=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,
e[5]=t[7],e[6]=o,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},d.invert=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=t[4],i=t[5],l=t[6],u=t[7],c=t[8],d=c*s-i*u,m=-c*a+i*l,g=u*a-s*l,h=n*d+o*m+r*g;return h?(h=1/h,e[0]=d*h,e[1]=(-c*o+r*u)*h,e[2]=(i*o-r*s)*h,e[3]=m*h,e[4]=(c*n-r*l)*h,e[5]=(-i*n+r*a)*h,e[6]=g*h,e[7]=(-u*n+o*l)*h,e[8]=(s*n-o*a)*h,e):null},d.adjoint=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=t[4],i=t[5],l=t[6],u=t[7],c=t[8];return e[0]=s*c-i*u,e[1]=r*u-o*c,e[2]=o*i-r*s,e[3]=i*l-a*c,e[4]=n*c-r*l,e[5]=r*a-n*i,e[6]=a*u-s*l,e[7]=o*l-n*u,e[8]=n*s-o*a,e},d.determinant=function(e){var t=e[0],n=e[1],o=e[2],r=e[3],a=e[4],s=e[5],i=e[6],l=e[7],u=e[8];return t*(u*a-s*l)+n*(-u*r+s*i)+o*(l*r-a*i)},d.multiply=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=t[4],l=t[5],u=t[6],c=t[7],d=t[8],m=n[0],g=n[1],h=n[2],f=n[3],v=n[4],y=n[5],p=n[6],x=n[7],b=n[8];return e[0]=m*o+g*s+h*u,e[1]=m*r+g*i+h*c,e[2]=m*a+g*l+h*d,e[3]=f*o+v*s+y*u,e[4]=f*r+v*i+y*c,e[5]=f*a+v*l+y*d,e[6]=p*o+x*s+b*u,e[7]=p*r+x*i+b*c,e[8]=p*a+x*l+b*d,e},d.mul=d.multiply,d.translate=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=t[4],l=t[5],u=t[6],c=t[7],d=t[8],m=n[0],g=n[1];return e[0]=o,e[1]=r,e[2]=a,e[3]=s,e[4]=i,e[5]=l,e[6]=m*o+g*s+u,e[7]=m*r+g*i+c,e[8]=m*a+g*l+d,e},d.rotate=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=t[4],l=t[5],u=t[6],c=t[7],d=t[8],m=Math.sin(n),g=Math.cos(n);return e[0]=g*o+m*s,e[1]=g*r+m*i,e[2]=g*a+m*l,e[3]=g*s-m*o,e[4]=g*i-m*r,e[5]=g*l-m*a,e[6]=u,e[7]=c,e[8]=d,e},d.scale=function(e,t,n){var o=n[0],r=n[1];return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},d.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},d.fromQuat=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=n+n,i=o+o,l=r+r,u=n*s,c=o*s,d=o*i,m=r*s,g=r*i,h=r*l,f=a*s,v=a*i,y=a*l;return e[0]=1-d-h,e[3]=c-y,e[6]=m+v,e[1]=c+y,e[4]=1-u-h,e[7]=g-f,e[2]=m-v,e[5]=g+f,e[8]=1-u-d,e},d.normalFromMat4=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=t[4],i=t[5],l=t[6],u=t[7],c=t[8],d=t[9],m=t[10],g=t[11],h=t[12],f=t[13],v=t[14],y=t[15],p=n*i-o*s,x=n*l-r*s,b=n*u-a*s,C=o*l-r*i,B=o*u-a*i,T=r*u-a*l,w=c*f-d*h,P=c*v-m*h,E=c*y-g*h,M=d*v-m*f,I=d*y-g*f,R=m*y-g*v,k=p*R-x*I+b*M+C*E-B*P+T*w;return k?(k=1/k,e[0]=(i*R-l*I+u*M)*k,e[1]=(l*E-s*R-u*P)*k,e[2]=(s*I-i*E+u*w)*k,e[3]=(r*I-o*R-a*M)*k,e[4]=(n*R-r*E+a*P)*k,e[5]=(o*E-n*I-a*w)*k,e[6]=(f*T-v*B+y*C)*k,e[7]=(v*b-h*T-y*x)*k,e[8]=(h*B-f*b+y*p)*k,e):null},d.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},d.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},"undefined"!=typeof e&&(e.mat3=d);var m={};m.create=function(){var e=new n(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},m.clone=function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},m.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},m.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},m.transpose=function(e,t){if(e===t){var n=t[1],o=t[2],r=t[3],a=t[6],s=t[7],i=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=o,e[9]=a,e[11]=t[14],e[12]=r,e[13]=s,e[14]=i}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},m.invert=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=t[4],i=t[5],l=t[6],u=t[7],c=t[8],d=t[9],m=t[10],g=t[11],h=t[12],f=t[13],v=t[14],y=t[15],p=n*i-o*s,x=n*l-r*s,b=n*u-a*s,C=o*l-r*i,B=o*u-a*i,T=r*u-a*l,w=c*f-d*h,P=c*v-m*h,E=c*y-g*h,M=d*v-m*f,I=d*y-g*f,R=m*y-g*v,k=p*R-x*I+b*M+C*E-B*P+T*w;return k?(k=1/k,e[0]=(i*R-l*I+u*M)*k,e[1]=(r*I-o*R-a*M)*k,e[2]=(f*T-v*B+y*C)*k,e[3]=(m*B-d*T-g*C)*k,e[4]=(l*E-s*R-u*P)*k,e[5]=(n*R-r*E+a*P)*k,e[6]=(v*b-h*T-y*x)*k,e[7]=(c*T-m*b+g*x)*k,e[8]=(s*I-i*E+u*w)*k,e[9]=(o*E-n*I-a*w)*k,e[10]=(h*B-f*b+y*p)*k,e[11]=(d*b-c*B-g*p)*k,e[12]=(i*P-s*M-l*w)*k,e[13]=(n*M-o*P+r*w)*k,e[14]=(f*x-h*C-v*p)*k,e[15]=(c*C-d*x+m*p)*k,e):null},m.adjoint=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=t[4],i=t[5],l=t[6],u=t[7],c=t[8],d=t[9],m=t[10],g=t[11],h=t[12],f=t[13],v=t[14],y=t[15];return e[0]=i*(m*y-g*v)-d*(l*y-u*v)+f*(l*g-u*m),e[1]=-(o*(m*y-g*v)-d*(r*y-a*v)+f*(r*g-a*m)),e[2]=o*(l*y-u*v)-i*(r*y-a*v)+f*(r*u-a*l),e[3]=-(o*(l*g-u*m)-i*(r*g-a*m)+d*(r*u-a*l)),e[4]=-(s*(m*y-g*v)-c*(l*y-u*v)+h*(l*g-u*m)),e[5]=n*(m*y-g*v)-c*(r*y-a*v)+h*(r*g-a*m),e[6]=-(n*(l*y-u*v)-s*(r*y-a*v)+h*(r*u-a*l)),e[7]=n*(l*g-u*m)-s*(r*g-a*m)+c*(r*u-a*l),e[8]=s*(d*y-g*f)-c*(i*y-u*f)+h*(i*g-u*d),e[9]=-(n*(d*y-g*f)-c*(o*y-a*f)+h*(o*g-a*d)),e[10]=n*(i*y-u*f)-s*(o*y-a*f)+h*(o*u-a*i),e[11]=-(n*(i*g-u*d)-s*(o*g-a*d)+c*(o*u-a*i)),e[12]=-(s*(d*v-m*f)-c*(i*v-l*f)+h*(i*m-l*d)),e[13]=n*(d*v-m*f)-c*(o*v-r*f)+h*(o*m-r*d),e[14]=-(n*(i*v-l*f)-s*(o*v-r*f)+h*(o*l-r*i)),e[15]=n*(i*m-l*d)-s*(o*m-r*d)+c*(o*l-r*i),e},m.determinant=function(e){var t=e[0],n=e[1],o=e[2],r=e[3],a=e[4],s=e[5],i=e[6],l=e[7],u=e[8],c=e[9],d=e[10],m=e[11],g=e[12],h=e[13],f=e[14],v=e[15],y=t*s-n*a,p=t*i-o*a,x=t*l-r*a,b=n*i-o*s,C=n*l-r*s,B=o*l-r*i,T=u*h-c*g,w=u*f-d*g,P=u*v-m*g,E=c*f-d*h,M=c*v-m*h,I=d*v-m*f;return y*I-p*M+x*E+b*P-C*w+B*T},m.multiply=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=t[4],l=t[5],u=t[6],c=t[7],d=t[8],m=t[9],g=t[10],h=t[11],f=t[12],v=t[13],y=t[14],p=t[15],x=n[0],b=n[1],C=n[2],B=n[3];return e[0]=x*o+b*i+C*d+B*f,e[1]=x*r+b*l+C*m+B*v,e[2]=x*a+b*u+C*g+B*y,e[3]=x*s+b*c+C*h+B*p,x=n[4],b=n[5],C=n[6],B=n[7],e[4]=x*o+b*i+C*d+B*f,e[5]=x*r+b*l+C*m+B*v,e[6]=x*a+b*u+C*g+B*y,e[7]=x*s+b*c+C*h+B*p,x=n[8],b=n[9],C=n[10],B=n[11],e[8]=x*o+b*i+C*d+B*f,e[9]=x*r+b*l+C*m+B*v,e[10]=x*a+b*u+C*g+B*y,e[11]=x*s+b*c+C*h+B*p,x=n[12],b=n[13],C=n[14],B=n[15],e[12]=x*o+b*i+C*d+B*f,e[13]=x*r+b*l+C*m+B*v,e[14]=x*a+b*u+C*g+B*y,e[15]=x*s+b*c+C*h+B*p,e},m.mul=m.multiply,m.translate=function(e,t,n){var o,r,a,s,i,l,u,c,d,m,g,h,f=n[0],v=n[1],y=n[2];return t===e?(e[12]=t[0]*f+t[4]*v+t[8]*y+t[12],e[13]=t[1]*f+t[5]*v+t[9]*y+t[13],e[14]=t[2]*f+t[6]*v+t[10]*y+t[14],e[15]=t[3]*f+t[7]*v+t[11]*y+t[15]):(o=t[0],r=t[1],a=t[2],s=t[3],i=t[4],l=t[5],u=t[6],c=t[7],d=t[8],m=t[9],g=t[10],h=t[11],e[0]=o,e[1]=r,e[2]=a,e[3]=s,e[4]=i,e[5]=l,e[6]=u,e[7]=c,e[8]=d,e[9]=m,e[10]=g,e[11]=h,e[12]=o*f+i*v+d*y+t[12],e[13]=r*f+l*v+m*y+t[13],e[14]=a*f+u*v+g*y+t[14],e[15]=s*f+c*v+h*y+t[15]),e},m.scale=function(e,t,n){var o=n[0],r=n[1],a=n[2];return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},m.rotate=function(e,n,o,r){var a,s,i,l,u,c,d,m,g,h,f,v,y,p,x,b,C,B,T,w,P,E,M,I,R=r[0],k=r[1],S=r[2],N=Math.sqrt(R*R+k*k+S*S);return Math.abs(N)<t?null:(N=1/N,R*=N,k*=N,S*=N,a=Math.sin(o),s=Math.cos(o),i=1-s,l=n[0],u=n[1],c=n[2],d=n[3],m=n[4],g=n[5],h=n[6],f=n[7],v=n[8],y=n[9],p=n[10],x=n[11],b=R*R*i+s,C=k*R*i+S*a,B=S*R*i-k*a,T=R*k*i-S*a,w=k*k*i+s,P=S*k*i+R*a,E=R*S*i+k*a,M=k*S*i-R*a,I=S*S*i+s,e[0]=l*b+m*C+v*B,e[1]=u*b+g*C+y*B,e[2]=c*b+h*C+p*B,e[3]=d*b+f*C+x*B,e[4]=l*T+m*w+v*P,e[5]=u*T+g*w+y*P,e[6]=c*T+h*w+p*P,e[7]=d*T+f*w+x*P,e[8]=l*E+m*M+v*I,e[9]=u*E+g*M+y*I,e[10]=c*E+h*M+p*I,e[11]=d*E+f*M+x*I,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)},m.rotateX=function(e,t,n){var o=Math.sin(n),r=Math.cos(n),a=t[4],s=t[5],i=t[6],l=t[7],u=t[8],c=t[9],d=t[10],m=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*r+u*o,e[5]=s*r+c*o,e[6]=i*r+d*o,e[7]=l*r+m*o,e[8]=u*r-a*o,e[9]=c*r-s*o,e[10]=d*r-i*o,e[11]=m*r-l*o,e},m.rotateY=function(e,t,n){var o=Math.sin(n),r=Math.cos(n),a=t[0],s=t[1],i=t[2],l=t[3],u=t[8],c=t[9],d=t[10],m=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r-u*o,e[1]=s*r-c*o,e[2]=i*r-d*o,e[3]=l*r-m*o,e[8]=a*o+u*r,e[9]=s*o+c*r,e[10]=i*o+d*r,e[11]=l*o+m*r,e},m.rotateZ=function(e,t,n){var o=Math.sin(n),r=Math.cos(n),a=t[0],s=t[1],i=t[2],l=t[3],u=t[4],c=t[5],d=t[6],m=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*r+u*o,e[1]=s*r+c*o,e[2]=i*r+d*o,e[3]=l*r+m*o,e[4]=u*r-a*o,e[5]=c*r-s*o,e[6]=d*r-i*o,e[7]=m*r-l*o,e},m.fromRotationTranslation=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=o+o,l=r+r,u=a+a,c=o*i,d=o*l,m=o*u,g=r*l,h=r*u,f=a*u,v=s*i,y=s*l,p=s*u;return e[0]=1-(g+f),e[1]=d+p,e[2]=m-y,e[3]=0,e[4]=d-p,e[5]=1-(c+f),e[6]=h+v,e[7]=0,e[8]=m+y,e[9]=h-v,e[10]=1-(c+g),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},m.fromQuat=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=n+n,i=o+o,l=r+r,u=n*s,c=o*s,d=o*i,m=r*s,g=r*i,h=r*l,f=a*s,v=a*i,y=a*l;return e[0]=1-d-h,e[1]=c+y,e[2]=m-v,e[3]=0,e[4]=c-y,e[5]=1-u-h,e[6]=g+f,e[7]=0,e[8]=m+v,e[9]=g-f,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},m.frustum=function(e,t,n,o,r,a,s){var i=1/(n-t),l=1/(r-o),u=1/(a-s);return e[0]=2*a*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(n+t)*i,e[9]=(r+o)*l,e[10]=(s+a)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*u,e[15]=0,e},m.perspective=function(e,t,n,o,r){var a=1/Math.tan(t/2),s=1/(o-r);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(r+o)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*r*o*s,e[15]=0,e},m.ortho=function(e,t,n,o,r,a,s){var i=1/(t-n),l=1/(o-r),u=1/(a-s);return e[0]=-2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*i,e[13]=(r+o)*l,e[14]=(s+a)*u,e[15]=1,e},m.lookAt=function(e,n,o,r){var a,s,i,l,u,c,d,g,h,f,v=n[0],y=n[1],p=n[2],x=r[0],b=r[1],C=r[2],B=o[0],T=o[1],w=o[2];return Math.abs(v-B)<t&&Math.abs(y-T)<t&&Math.abs(p-w)<t?m.identity(e):(d=v-B,g=y-T,h=p-w,f=1/Math.sqrt(d*d+g*g+h*h),d*=f,g*=f,h*=f,a=b*h-C*g,s=C*d-x*h,i=x*g-b*d,f=Math.sqrt(a*a+s*s+i*i),f?(f=1/f,a*=f,s*=f,i*=f):(a=0,s=0,i=0),l=g*i-h*s,u=h*a-d*i,c=d*s-g*a,f=Math.sqrt(l*l+u*u+c*c),f?(f=1/f,l*=f,u*=f,c*=f):(l=0,u=0,c=0),e[0]=a,e[1]=l,e[2]=d,e[3]=0,e[4]=s,e[5]=u,e[6]=g,e[7]=0,e[8]=i,e[9]=c,e[10]=h,e[11]=0,e[12]=-(a*v+s*y+i*p),e[13]=-(l*v+u*y+c*p),e[14]=-(d*v+g*y+h*p),e[15]=1,e)},m.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},m.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},"undefined"!=typeof e&&(e.mat4=m);var g={};g.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},g.rotationTo=function(){var e=i.create(),t=i.fromValues(1,0,0),n=i.fromValues(0,1,0);return function(o,r,a){var s=i.dot(r,a);return-.999999>s?(i.cross(e,t,r),i.length(e)<1e-6&&i.cross(e,n,r),i.normalize(e,e),g.setAxisAngle(o,e,Math.PI),o):s>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(i.cross(e,r,a),o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=1+s,g.normalize(o,o))}}(),g.setAxes=function(){var e=d.create();return function(t,n,o,r){return e[0]=o[0],e[3]=o[1],e[6]=o[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],g.normalize(t,g.fromMat3(t,e))}}(),g.clone=l.clone,g.fromValues=l.fromValues,g.copy=l.copy,g.set=l.set,g.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},g.setAxisAngle=function(e,t,n){n*=.5;var o=Math.sin(n);return e[0]=o*t[0],e[1]=o*t[1],e[2]=o*t[2],e[3]=Math.cos(n),e},g.add=l.add,g.multiply=function(e,t,n){var o=t[0],r=t[1],a=t[2],s=t[3],i=n[0],l=n[1],u=n[2],c=n[3];return e[0]=o*c+s*i+r*u-a*l,e[1]=r*c+s*l+a*i-o*u,e[2]=a*c+s*u+o*l-r*i,e[3]=s*c-o*i-r*l-a*u,e},g.mul=g.multiply,g.scale=l.scale,g.rotateX=function(e,t,n){n*=.5;var o=t[0],r=t[1],a=t[2],s=t[3],i=Math.sin(n),l=Math.cos(n);return e[0]=o*l+s*i,e[1]=r*l+a*i,e[2]=a*l-r*i,e[3]=s*l-o*i,e},g.rotateY=function(e,t,n){n*=.5;var o=t[0],r=t[1],a=t[2],s=t[3],i=Math.sin(n),l=Math.cos(n);return e[0]=o*l-a*i,e[1]=r*l+s*i,e[2]=a*l+o*i,e[3]=s*l-r*i,e},g.rotateZ=function(e,t,n){n*=.5;var o=t[0],r=t[1],a=t[2],s=t[3],i=Math.sin(n),l=Math.cos(n);return e[0]=o*l+r*i,e[1]=r*l-o*i,e[2]=a*l+s*i,e[3]=s*l-a*i,e},g.calculateW=function(e,t){var n=t[0],o=t[1],r=t[2];return e[0]=n,e[1]=o,e[2]=r,e[3]=-Math.sqrt(Math.abs(1-n*n-o*o-r*r)),e},g.dot=l.dot,g.lerp=l.lerp,g.slerp=function(e,t,n,o){var r,a,s,i,l,u=t[0],c=t[1],d=t[2],m=t[3],g=n[0],h=n[1],f=n[2],v=n[3];return a=u*g+c*h+d*f+m*v,0>a&&(a=-a,g=-g,h=-h,f=-f,v=-v),1-a>1e-6?(r=Math.acos(a),s=Math.sin(r),i=Math.sin((1-o)*r)/s,l=Math.sin(o*r)/s):(i=1-o,l=o),e[0]=i*u+l*g,e[1]=i*c+l*h,e[2]=i*d+l*f,e[3]=i*m+l*v,e},g.invert=function(e,t){var n=t[0],o=t[1],r=t[2],a=t[3],s=n*n+o*o+r*r+a*a,i=s?1/s:0;return e[0]=-n*i,e[1]=-o*i,e[2]=-r*i,e[3]=a*i,e},g.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},g.length=l.length,g.len=g.length,g.squaredLength=l.squaredLength,g.sqrLen=g.squaredLength,g.normalize=l.normalize,g.fromMat3=function(e,t){var n,o=t[0]+t[4]+t[8];if(o>0)n=Math.sqrt(o+1),e[3]=.5*n,n=.5/n,e[0]=(t[7]-t[5])*n,e[1]=(t[2]-t[6])*n,e[2]=(t[3]-t[1])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var a=(r+1)%3,s=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*a+a]-t[3*s+s]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*s+a]-t[3*a+s])*n,e[a]=(t[3*a+r]+t[3*r+a])*n,e[s]=(t[3*s+r]+t[3*r+s])*n}return e},g.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!=typeof e&&(e.quat=g)}(t.exports)}(this);var socket=io.connect(),selectedRoom,roomList;socket.emit("get room list"),socket.on("recieve room list",function(e){roomList=e;for(var t=0;t<e.length;t++){var n=!1;0==t&&(n=!0),createRadioElement("rooms",e[t].id,n)}for(var o=document.getElementById("room-list"),r=o.getElementsByTagName("tbody")[0],t=0;t<e.length;t++){var a=r.insertRow(t);a.id=e[t].id,a.onclick=function(){selectedRoom=this.id;var e=document.getElementById(this.id+"-radio");e.checked=!0;for(var t=document.getElementById("room-list").rows,n=0;n<t.length;n++)t[n].cells[0].className="",t[n].cells[1].className="",t[n].cells[2].className="";var o=document.getElementById(this.id);o.cells[0].className="row-selected",o.cells[1].className="row-selected",o.cells[2].className="row-selected"};var s=a.insertCell(0),i=a.insertCell(1),l=a.insertCell(2);s.innerHTML=e[t].id,i.innerHTML=e[t].users+"/10";var u=((new Date).getTime()-e[t].activity)/1e3;l.innerHTML=convertTime(u),0==t&&(selectedRoom=e[t].id,s.className="row-selected",i.className="row-selected",l.className="row-selected")}isOverflowed(document.getElementById("table-wrap-scroll"))&&(document.getElementById("room-id").style.width="179px",document.getElementById("no-users").style.width="134px")}),checkHomeState(),checkPageState()&&(socket.emit("does room exist",getURLParam("room")),socket.on("does room exist result",function(e){1==e?(document.getElementById("name-box").className="",document.getElementById("name-content").className=""):(document.getElementById("name-box").className="",document.getElementById("room-not-exist").className="",document.getElementById("name-content").className="Invisible")}),socket.on("room does not exist",function(){document.getElementById("name-box").className="",document.getElementById("room-not-exist").className="",document.getElementById("name-content").className="Invisible"}));var basicFragShader="precision mediump float;varying vec4 vColor;void main(void) {gl_FragColor = vColor;}",basicVertShader="attribute vec3 aVertexPosition;attribute vec4 aVertexColor;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying vec4 vColor;void main(void) {gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);vColor = aVertexColor;}",Room=function(){this.searchRoom=function(){for(var e=document.getElementById("room-list"),t=e.getElementsByTagName("tbody")[0],n=t.rows,o=document.getElementById("room-search"),r=0;r<n.length;r++)n[r].className="",""!=o.value&&-1==n[r].cells[0].innerHTML.indexOf(o.value)&&(n[r].className="invisible")}},ToolSet=function(){this.brush=new Brush,this.textTool=new TextTool,this.shapeTool=new ShapeTool,this.getBrushType=function(){return this.brush.getBrushType()}},Brush=function(){this.size=30,this.colour="#ff0000",this.brushType="freeroam",this.lineTip="round",this.gradientTimer=0,this.gradientSpeed=1,this.gradientSwitch=!1,this.rainbowPointer=0,this.rainbowSpeed=1,this.setBrushType=function(e){this.brushType=e},this.getBrushType=function(){return this.brushType},this.setBrushSize=function(e){this.size=e},this.getBrushSize=function(){return this.size},this.setColour=function(e){this.colour=e},this.drawBrushOutline=function(e,t){var n=pointerCanvas.getBoundingClientRect(),o=this.size/2;1.5>=o&&(o=1.5),pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height),pointerContext.lineWidth=1,pointerContext.lineCap="round",pointerContext.beginPath(),pointerContext.strokeStyle="white",pointerContext.arc(e-n.left,t-n.top,Math.abs(o+1),0,2*Math.PI),pointerContext.stroke(),pointerContext.beginPath(),pointerContext.strokeStyle="black",pointerContext.arc(e-n.left,t-n.top,Math.abs(o),0,2*Math.PI),pointerContext.stroke(),pointerContext.beginPath(),pointerContext.strokeStyle="white",pointerContext.arc(e-n.left,t-n.top,Math.abs(o-1),0,2*Math.PI),pointerContext.stroke()},this.drawEraserOutline=function(e,t){var n=pointerCanvas.getBoundingClientRect(),o=this.size/2;1.5>=o&&(o=1.5),pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height),pointerContext.lineWidth=1,pointerContext.lineCap="round",pointerContext.beginPath(),pointerContext.rect(e-n.left-o-1,t-n.top-o-1,2*o+2,2*o+2),pointerContext.strokeStyle="white",pointerContext.stroke(),pointerContext.beginPath(),pointerContext.rect(e-n.left-o,t-n.top-o,2*o,2*o),pointerContext.strokeStyle="black",pointerContext.stroke(),pointerContext.beginPath(),pointerContext.rect(e-n.left-o+1,t-n.top-o+1,2*o-2,2*o-2),pointerContext.strokeStyle="white",pointerContext.stroke()},this.gradientDraw=function(){if(currentlyVoting===!1&&currentlySaving===!1){canvasRect=canvas.getBoundingClientRect();var e=convertHexToRGB(tool.brush.colour);e.r-=this.gradientTimer,e.g-=this.gradientTimer,e.b-=this.gradientTimer,e.r<=0&&(e.r=0),e.g<=0&&(e.g=0),e.b<=0&&(e.b=0);var t=convertRGBToHex(e.r,e.g,e.b),n={name:name,x:mousePos.x-canvasRect.left,y:mousePos.y-canvasRect.top,lastX:lastPos.x-canvasRect.left,lastY:lastPos.y-canvasRect.top,size:tool.brush.size,colour:t};tool.shapeTool.drawCircle(n.x,n.y,n.lastX,n.lastY,n.size,n.colour),socket.emit("draw",n)}},this.rainbowDraw=function(){if(currentlyVoting===!1&&currentlySaving===!1){canvasRect=canvas.getBoundingClientRect();{convertHexToRGB(tool.brush.colour)}huePointer={x:0,y:this.rainbowPointer};var e=getColourOnHueCanvas(),t=convertRGBToHex(e.r,e.g,e.b),n={name:name,x:mousePos.x-canvasRect.left,y:mousePos.y-canvasRect.top,lastX:lastPos.x-canvasRect.left,lastY:lastPos.y-canvasRect.top,size:this.size,colour:t};tool.shapeTool.drawCircle(n.x,n.y,n.lastX,n.lastY,n.size,n.colour),socket.emit("draw",n)}},this.drawTempLine=function(e,t,n,o,r,a){var s=pointerCanvas.getBoundingClientRect();pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height),pointerContext.strokeStyle=r,pointerContext.lineWidth=a,pointerContext.lineCap=tool.brush.lineTip,pointerContext.beginPath(),pointerContext.moveTo(e-s.left,t-s.top),pointerContext.lineTo(n-s.left,o-s.top),pointerContext.stroke()},this.drawShapeLine=function(e,t,n,o,r,a){context.strokeStyle=r,context.lineWidth=a,context.lineCap=tool.brush.lineTip,context.beginPath(),context.moveTo(e,t),context.lineTo(n,o),context.stroke()},this.draw=function(){if(currentlyVoting===!1&&currentlySaving===!1){canvasRect=canvas.getBoundingClientRect();var e={name:name,x:mousePos.x-canvasRect.left,y:mousePos.y-canvasRect.top,lastX:lastPos.x-canvasRect.left,lastY:lastPos.y-canvasRect.top,size:tool.brush.size,colour:tool.brush.colour};tool.shapeTool.drawCircle(e.x,e.y,e.lastX,e.lastY,e.size,e.colour),socket.emit("draw",e)}},this.erase=function(){if(currentlyVoting===!1&&currentlySaving===!1){canvasRect=canvas.getBoundingClientRect();var e={name:name,x:mousePos.x-canvasRect.left,y:mousePos.y-canvasRect.top,lastX:lastPos.x-canvasRect.left,lastY:lastPos.y-canvasRect.top,size:tool.brush.size,colour:tool.brush.colour};tool.shapeTool.drawRect(e.x,e.y,e.lastX,e.lastY,e.size,"white"),socket.emit("erase",e)}},this.drawSquare=function(){if(currentlyVoting===!1&&currentlySaving===!1){canvasRect=canvas.getBoundingClientRect();var e={name:name,x:mousePos.x-canvasRect.left,y:mousePos.y-canvasRect.top,lastX:lastPos.x-canvasRect.left,lastY:lastPos.y-canvasRect.top,size:tool.brush.size,colour:tool.brush.colour};tool.shapeTool.drawRect(e.x,e.y,e.lastX,e.lastY,e.size,e.colour),socket.emit("draw square",e)}}},TextTool=function(){this.textToRender="",this.textFont="20px Arial",this.drawText=function(e,t,n,o,r){context.font=n,context.fillStyle=o,context.fillText(r,e,t)},this.drawTempText=function(e,t,n,o,r){var a=pointerCanvas.getBoundingClientRect();pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height),pointerContext.font=n,pointerContext.fillStyle=o,pointerContext.fillText(r,e-a.left,t-a.top)},this.changeFont=function(){var e=document.getElementById("fontSel"),t=e.options[e.selectedIndex].value,n=tool.textTool.textFont.split(" ");this.textFont=n[0]+" "+t,this.drawTempText(textPos.x,textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender)},this.changeTextSize=function(e){var t=document.getElementById("fontSel"),n=t.options[t.selectedIndex].value;this.textFont=e+"px "+n,this.drawTempText(textPos.x,textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender)}},ShapeTool=function(){this.shapeType="rectangle",this.getShapeType=function(){return this.shapeType},this.setShapeType=function(e,t){document.getElementById("shapeRect").className="button tool",document.getElementById("shapeCircle").className="button tool",e.className="button bselect tool",shapeType=t},this.drawRect=function(e,t,n,o,r,a){for(var s={x:n,y:o},i={x:e,y:t},l=distanceBetween(s,i),u=angleBetween(s,i),c=0;l>c;c+=1)x=s.x+Math.sin(u)*c,y=s.y+Math.cos(u)*c,context.fillStyle=a,context.fillRect(x-r/2,y-r/2,r,r)},this.drawTempRect=function(e,t,n,o){var r=pointerCanvas.getBoundingClientRect();pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height),pointerContext.fillStyle=tool.brush.colour,pointerContext.fillRect(e-r.left,t-r.top,n-e,o-t)},this.drawShapeRect=function(e,t,n,o,r){context.fillStyle=r,context.fillRect(e,t,n-e,o-t)},this.drawCircle=function(e,t,n,o,r,a){for(var s={x:n,y:o},i={x:e,y:t},l=distanceBetween(s,i),u=angleBetween(s,i),c=0;l>c;c+=1)x=s.x+Math.sin(u)*c,y=s.y+Math.cos(u)*c,context.beginPath(),context.fillStyle=a,context.arc(x,y,r/2,!1,2*Math.PI,!1),context.closePath(),context.fill()},this.drawTempCircle=function(e,t,n,o,r){var a=pointerCanvas.getBoundingClientRect();pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height),pointerContext.beginPath();var s=0;s=Math.abs(Math.abs(n-e)>Math.abs(o-t)?n-e:o-t),pointerContext.arc(e-a.left,t-a.top,s,0,2*Math.PI,!1),pointerContext.fillStyle=r,pointerContext.fill()},this.drawShapeCircle=function(e,t,n,o,r){context.beginPath();var a=0;a=Math.abs(Math.abs(n-e)>Math.abs(o-t)?n-e:o-t),context.arc(e,t,a,0,2*Math.PI,!1),context.fillStyle=r,context.fill()}},mouseDown=!1,mousePos={x:0,y:0},lastPos={x:0,y:0},socket=io.connect(),hasSynced=!1,canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),pointerCanvas=document.getElementById("pointer-canvas"),pointerContext=pointerCanvas.getContext("2d"),canDraw=!1,tool=new ToolSet,room=new Room,name,randomNames,connectedUsers,currentlyVoting=!1,readyForText=!1,currentlySaving=!1,textPos={x:0,y:0},readyForShape=!1,shapeType="rectangle",shapePos={x:0,y:0},shapeEndPos={x:0,y:0},messageCounter=0,userJoinCounter=0,canvasRect=canvas.getBoundingClientRect();document.getElementById("chat-message").onkeypress=function(e){e||(e=window.event);var t=e.keyCode||e.which;return"13"==t?(sendChatMessage(),!1):void 0},document.getElementById("name").onkeypress=function(e){e||(e=window.event);var t=e.keyCode||e.which;return"13"==t?(sync(),!1):void 0},socket.on("cannot create room",function(e){alert(e)}),socket.on("room result",function(e){insertURLParam("room",e)}),socket.on("name taken",function(){document.getElementById("name-taken").className=""}),socket.on("user validated",function(){document.getElementById("name-content").className="invisible",document.getElementById("name-taken").className="invisible",document.getElementById("currently-syncing").className="",socket.emit("sync")}),socket.on("room full",function(){document.getElementById("room-full").className=""}),socket.on("sync draw",function(e){tool.shapeTool.drawCircle(e.x,e.y,e.lastX,e.lastY,e.size,e.colour)}),socket.on("sync draw text",function(e){tool.textTool.drawText(e.x,e.y,e.font,e.colour,e.text)}),socket.on("sync draw rect",function(e){tool.shapeTool.drawShapeRect(e.x,e.y,e.endX,e.endY,e.colour)}),socket.on("sync draw circle",function(e){tool.shapeTool.drawShapeCircle(e.x,e.y,e.endX,e.endY,e.colour)}),socket.on("sync draw line",function(e){tool.brush.drawShapeLine(e.x,e.y,e.endX,e.endY,e.colour,e.size,e.lineTip)}),socket.on("sync erase",function(e){tool.shapeTool.drawRect(e.x,e.y,e.lastX,e.lastY,e.size,"white")}),socket.on("sync draw square",function(e){tool.shapeTool.drawRect(e.x,e.y,e.lastX,e.lastY,e.size,"white")}),socket.on("sync result",function(e){if(document.getElementById("name-wrap").className="invisible",null!=e){var t=new Image;t.onload=function(){context.drawImage(t,0,0)},t.src=e}hasSynced=!0}),socket.on("send canvas",function(){socket.emit("recieve canvas",canvas.toDataURL())}),socket.on("user list",function(e){if(clearUsers(),0!=e.length){connectedUsers=e.length;for(var t=0;t<e.length;t++)null!=e[t]&&(e[t].name==name?addUser(e[t].name+" (you)",e[t].colour):addUser(e[t].name,e[t].colour));var n=document.getElementById("users-online-tab");"tab selected"!=n.className?(userJoinCounter++,n.innerHTML='<a>Users Online</a><div class="orange-notification">'+userJoinCounter+"</div>"):userJoinCounter=0}}),socket.on("sync user colour",function(e){if(0!=e.length)for(var t=0;t<e.length;t++){var n;e[t].name===name?(n=document.getElementById(e[t].name+" (you)"),null!=n&&(n.innerHTML='<div class="user-colour" style="background-color:'+e[t].colour+'"></div><div class="user-name">'+e[t].name+" (you)</div>")):(n=document.getElementById(e[t].name),null!=n&&(n.innerHTML='<div class="user-colour" style="background-color:'+e[t].colour+'"></div><div class="user-name">'+e[t].name+"</div>"))}}),socket.on("recieve clear canvas",function(){context.fillStyle="white",context.fillRect(0,0,canvas.width,canvas.height)}),socket.on("send vote clear",function(e){currentlyVoting=!0;var t=document.getElementById("clear-canvas-vote-box");t.className="",document.getElementById("timeRemain").innerHTML=e}),socket.on("send clear vote timer",function(e){var t=document.getElementById("clear-canvas-vote-box");t.className="",document.getElementById("clear-wrap").className="table-visible",document.getElementById("result").className="invisible",document.getElementById("time").className="",document.getElementById("timeRemain").innerHTML=e.timeRemaining,document.getElementById("pYes").innerHTML="Yes: "+e.yesVotes,document.getElementById("pNo").innerHTML="No: "+e.noVotes,document.getElementById("pTotal").innerHTML="Total Possible: "+e.total,currentlyVoting===!1&&(document.getElementById("voteButtons").className="invisible")}),socket.on("send clear vote result",function(e){document.getElementById("result").className="",document.getElementById("time").className="invisible",document.getElementById("resultData").innerHTML=e}),socket.on("cannot start vote",function(e){document.getElementById("voteButtons").className="",alert("Cannot vote to clear for another: "+e+" seconds.")}),socket.on("unlock canvas",function(){currentlyVoting=!1,document.getElementById("clear-wrap").className="invisible",document.getElementById("voteButtons").className=""}),socket.on("sync chat message",function(e){addChatMessage(e);var t=document.getElementById("users-chat-tab");"tab selected"!=t.className?(messageCounter++,t.innerHTML='<a>Chat</a><div class="orange-notification">'+messageCounter+"</div>"):messageCounter=0}),socket.on("canvas saved",function(){(new Date).getTime();document.getElementById("save-complete").className="",document.getElementById("save-progress").className="invisible",setTimeout(function(){document.getElementById("save-wrap").className="invisible",document.getElementById("save-complete").className="invisible",document.getElementById("save-progress").className="",currentlySaving=!1},1500)}),socket.on("room does not exist",function(){location.reload()});var myEvent=window.attachEvent||window.addEventListener,chkevent=window.attachEvent?"onbeforeunload":"beforeunload";myEvent(chkevent,function(){var e={name:name,colour:tool.brush.colour};1>=connectedUsers?(e.canvas=canvas.toDataURL(),socket.emit("im offline store canvas",e)):socket.emit("im offline",e)}),document.getElementById("brushSelection").addEventListener("input",function(){tool.brush.setBrushSize(this.value)}),speedSelection.addEventListener("input",function(){tool.brush.rainbowSpeed=parseInt(this.value),tool.brush.gradientSpeed=parseInt(this.value)});var textSizeSel=document.getElementById("textSizeSel");textSizeSel.addEventListener("input",function(){tool.textTool.changeTextSize(this.value)}),document.addEventListener("mousemove",function(e){if(lastPos=mousePos,mousePos=getMousePos(e),"freeroam"===tool.getBrushType()||"gradient-brush"===tool.getBrushType()||"rainbow-brush"===tool.getBrushType()?tool.brush.drawBrushOutline(mousePos.x,mousePos.y):("eraser"===tool.getBrushType()||"square-brush"===tool.getBrushType())&&tool.brush.drawEraserOutline(mousePos.x,mousePos.y),mouseDown===!0&&hasSynced===!0&&canDraw===!0)if("freeroam"===tool.getBrushType())tool.brush.draw();else if("gradient-brush"===tool.getBrushType())tool.brush.gradientTimer>=255?tool.brush.gradientSwitch=!0:tool.brush.gradientTimer<=0&&(tool.brush.gradientSwitch=!1),tool.brush.gradientSwitch===!0?tool.brush.gradientTimer-=tool.brush.gradientSpeed:tool.brush.gradientTimer+=tool.brush.gradientSpeed,tool.brush.gradientDraw();else if("rainbow-brush"===tool.getBrushType())tool.brush.rainbowPointer+=tool.brush.rainbowSpeed,tool.brush.rainbowPointer>=255&&(tool.brush.rainbowPointer=0),tool.brush.rainbowDraw();else if("dropper"===tool.getBrushType()){if(mouseIsHoveringCanvas(canvas)&&currentlyVoting===!1&&currentlySaving===!1){var t=getColourOnCanvas(canvas,context);onColourChange(t)}}else"eraser"===tool.getBrushType()?tool.brush.erase():"square-brush"===tool.getBrushType()?tool.brush.drawSquare():"text"===tool.getBrushType()?(textPos=mousePos,tool.textTool.drawTempText(textPos.x,textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender)):"shape"===tool.getBrushType()?readyForShape===!0&&currentlyVoting===!1&&currentlySaving===!1&&(shapeEndPos=mousePos,"rectangle"===shapeType?tool.shapeTool.drawTempRect(shapePos.x,shapePos.y,shapeEndPos.x,shapeEndPos.y,tool.brush.colour):"circle"===shapeType&&tool.shapeTool.drawTempCircle(shapePos.x,shapePos.y,shapeEndPos.x,shapeEndPos.y,tool.brush.colour)):"line"===tool.getBrushType()&&readyForShape===!0&&currentlyVoting===!1&&currentlySaving===!1&&(shapeEndPos=mousePos,
tool.brush.drawTempLine(shapePos.x,shapePos.y,shapeEndPos.x,shapeEndPos.y,tool.brush.colour,tool.brush.size,tool.brush.lineTip));else hasSynced===!0&&changeColour()},!1),document.addEventListener("mousedown",function(e){if(canvas.className="dragged",0===e.button&&(mouseDown=!0,mouseDown===!0&&hasSynced===!0&&(canMoveTintPointer===!1&&(mouseIsHoveringCanvas(tintCanvas)?(canMoveTintPointer=!0,canDraw=!1):mouseIsHoveringCanvas(hueCanvas)&&(canMoveHuePointer=!0,canDraw=!1)),canDraw===!1&&mouseIsHoveringCanvas(canvas)&&(canDraw=!0),changeColour(),canDraw===!0)))if("freeroam"===tool.getBrushType())tool.brush.draw();else if("gradient-brush"===tool.getBrushType())tool.brush.gradientTimer=0,tool.brush.gradientDraw();else if("rainbow-brush"===tool.getBrushType())tool.brush.rainbowDraw();else if("dropper"===tool.getBrushType()){if(mouseIsHoveringCanvas(canvas)&&currentlyVoting===!1&&currentlySaving===!1){var t=getColourOnCanvas(canvas,context);onColourChange(t)}}else"text"===tool.getBrushType()?(currentlyVoting===!1&&currentlySaving===!1&&(readyForText=!0,textPos=mousePos),tool.textTool.drawTempText(textPos.x,textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender)):"shape"===tool.getBrushType()?readyForShape===!1&&currentlyVoting===!1&&currentlySaving===!1&&(readyForShape=!0,shapePos=mousePos):"line"===tool.getBrushType()?readyForShape===!1&&currentlyVoting===!1&&currentlySaving===!1&&(readyForShape=!0,shapePos=mousePos):"eraser"===tool.getBrushType()?tool.brush.erase():"fillBucket"===tool.getBrushType()&&(fillBucket(context,tool.brush.colour),tool.brush.setBrushType("freeroam"))}),document.addEventListener("mouseup",function(e){if(canvas.className="",0===e.button){if(mouseDown=!1,readyForShape===!0){if(pointerContext.clearRect(0,0,pointerCanvas.width,pointerCanvas.height),canvasRect=canvas.getBoundingClientRect(),"shape"===tool.getBrushType()){if(currentlyVoting===!1&&currentlySaving===!1){var t={x:shapePos.x-canvasRect.left,y:shapePos.y-canvasRect.top,endX:shapeEndPos.x-canvasRect.left,endY:shapeEndPos.y-canvasRect.top,colour:tool.brush.colour};"rectangle"===shapeType?(tool.shapeTool.drawShapeRect(t.x,t.y,t.endX,t.endY,t.colour),socket.emit("draw rect",t)):"circle"===shapeType&&(tool.shapeTool.drawShapeCircle(t.x,t.y,t.endX,t.endY,t.colour),socket.emit("draw circle",t))}}else if("line"===tool.getBrushType()&&currentlyVoting===!1&&currentlySaving===!1){var n={x:shapePos.x-canvasRect.left,y:shapePos.y-canvasRect.top,endX:shapeEndPos.x-canvasRect.left,endY:shapeEndPos.y-canvasRect.top,lineTip:tool.brush.lineTip,size:tool.brush.size,colour:tool.brush.colour};tool.brush.drawShapeLine(n.x,n.y,n.endX,n.endY,n.colour,n.size,n.lineTip),socket.emit("draw line",n)}readyForShape=!1}readyForShape=!1,canMoveTintPointer===!0&&(canMoveTintPointer=!1),canMoveHuePointer===!0&&(canMoveHuePointer=!1),canDraw===!0&&(canDraw=!1)}}),document.body.addEventListener("keydown",function(e){readyForText===!0&&currentlyVoting===!1&&currentlySaving===!1&&(tool.textTool.textToRender=document.getElementById("text-tool-text").value,tool.textTool.drawTempText(textPos.x,textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender),document.getElementById("text-tool-text").focus(),13==e.keyCode&&applyText())}),document.body.addEventListener("keyup",function(){readyForText===!0&&currentlyVoting===!1&&currentlySaving===!1&&(tool.textTool.textToRender=document.getElementById("text-tool-text").value,tool.textTool.drawTempText(textPos.x,textPos.y,tool.textTool.textFont,tool.brush.colour,tool.textTool.textToRender))}),document.getElementById("room-search").addEventListener("change",function(){room.searchRoom()}),document.getElementById("fontSel").addEventListener("change",function(){tool.textTool.changeFont()}),document.getElementById("clearCanvas").addEventListener("click",function(){clearCanvas()}),document.getElementById("brushes").addEventListener("click",function(){tool.brush.setBrushType("freeroam"),resetCategoryFlags(),resetSubCategoryFlags(),this.className="button bselect tool",document.getElementById("brush-settings").className="inline-block";var e=document.getElementById("brush");e.className="button bselect tool"}),document.getElementById("brush").addEventListener("click",function(){resetSubCategoryFlags(),tool.brush.setBrushType("freeroam"),this.className="button bselect tool",document.getElementById("brush-settings").className="inline-block",document.getElementById("canvas").style.cursor="none",document.getElementById("pointer-canvas").style.cursor="none"}),document.getElementById("square-brush").addEventListener("click",function(){resetSubCategoryFlags(),tool.brush.setBrushType("square-brush"),this.className="button bselect tool",document.getElementById("brush-settings").className="inline-block",document.getElementById("canvas").style.cursor="none",document.getElementById("pointer-canvas").style.cursor="none"}),document.getElementById("gradient-brush").addEventListener("click",function(){resetSubCategoryFlags(),tool.brush.setBrushType("gradient-brush"),this.className="button bselect tool",document.getElementById("brush-settings").className="",document.getElementById("rainbow-settings").className="inline-block",document.getElementById("canvas").style.cursor="none",document.getElementById("pointer-canvas").style.cursor="none"}),document.getElementById("rainbow-brush").addEventListener("click",function(){resetSubCategoryFlags(),tool.brush.setBrushType("rainbow-brush"),this.className="button bselect tool",document.getElementById("brush-settings").className="",document.getElementById("rainbow-settings").className="inline-block",document.getElementById("canvas").style.cursor="none",document.getElementById("pointer-canvas").style.cursor="none"}),document.getElementById("line-tool").addEventListener("click",function(){resetSubCategoryFlags(),tool.brush.setBrushType("line"),this.className="button bselect tool",document.getElementById("canvas").style.cursor="pointer",document.getElementById("pointer-canvas").style.cursor="pointer",document.getElementById("brush-settings").className="",document.getElementById("line-settings").className="inline-block"}),document.getElementById("eraser").addEventListener("click",function(){resetSubCategoryFlags(),tool.brush.setBrushType("eraser"),this.className="button bselect tool",document.getElementById("brush-settings").className=""}),document.getElementById("shape-tool").addEventListener("click",function(){resetCategoryFlags(),resetSubCategoryFlags(),tool.brush.setBrushType("shape"),tool.shapeTool.setShapeType(document.getElementById("shapeRect"),"rectangle"),this.className="button bselect tool",document.getElementById("canvas").style.cursor="pointer",document.getElementById("pointer-canvas").style.cursor="pointer",document.getElementById("shape-settings").className=""}),document.getElementById("shapeRect").addEventListener("click",function(){resetSubCategoryFlags(),tool.shapeTool.setShapeType(this,"rectangle"),document.getElementById("shape-settings").className="inline-block"}),document.getElementById("shapeCircle").addEventListener("click",function(){resetSubCategoryFlags(),tool.shapeTool.setShapeType(this,"circle"),document.getElementById("shape-settings").className="inline-block"}),document.getElementById("text-tool").addEventListener("click",function(){resetCategoryFlags(),resetSubCategoryFlags(),tool.brush.setBrushType("text"),this.className="button bselect tool",document.getElementById("canvas").style.cursor="text",document.getElementById("pointer-canvas").style.cursor="text",document.getElementById("text-settings").className=""}),document.getElementById("colourDrop").addEventListener("click",function(){tool.brush.setBrushType("dropper"),resetCategoryFlags(),resetSubCategoryFlags(),this.className="button bselect tool",document.getElementById("pointer-canvas").style.cursor="crosshair",document.getElementById("dropper-settings").className=""}),document.getElementById("saveCanvas").addEventListener("click",function(){window.open(canvas.toDataURL())});var squareVertexPositionBuffer,squareVertexColorBuffer,blackVertexColorBuffer,gl,mvMatrix=mat4.create(),pMatrix=mat4.create(),shaderProgram,pickedColour={r:255,g:0,b:0},tintCtx,tintPointerCtx,hueCtx,image,webglCanvas,hueCanvas,tintCanvas,tintPointerCanvas,tintPointer={x:0,y:0},huePointer={y:0},canMoveTintPointer=!1,canMoveHuePointer=!1,colourTimer=(new Date).getTime(),usersOnlineTab=document.getElementById("users-online-tab"),usersChatTab=document.getElementById("users-chat-tab");usersOnlineTab.onclick=function(){usersOnlineTab.className="tab selected",usersChatTab.className="tab";var e=document.getElementById("users-online");e.className="visible";var t=document.getElementById("users-chat");t.className="invisible",clearUserCounter()},usersChatTab.onclick=function(){usersChatTab.className="tab selected",usersOnlineTab.className="tab";var e=document.getElementById("users-chat");e.className="visible";var t=document.getElementById("users-online");t.className="invisible",clearChatNotifs()};